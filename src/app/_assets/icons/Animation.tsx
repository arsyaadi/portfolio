import React, { useEffect, useLayoutEffect, useRef } from "react";
import gsap from "gsap";

interface Props {
  setIsShow: (isShow: boolean) => void;
}

const IconAnimation = ({ setIsShow }: Props) => {
  const logoRef = useRef<SVGSVGElement>(null);
  const [isHidden, setIsHidden] = React.useState(true);

  useLayoutEffect(() => {
    const logo = logoRef.current;

    // Set initial state (hidden)
    gsap.set(logo, { opacity: 0 });

    // Ensure the initial hiding is applied before the first paint
    setIsHidden(false);
  }, []);

  useEffect(() => {
    const logo = logoRef.current;

    const tl = gsap.timeline({ 
        defaults: { ease: "power1.out" },
        onComplete: () => {
          setIsHidden(true)
          setIsShow(true)
        }
    });
    
    // Initial state (hidden)
    tl.set(logo, { opacity: 0 });
    // Fade in
    tl.to(logo, { opacity: 1, duration: 0.8 });

    // Select all paths inside the SVG
    const paths = logo?.querySelectorAll('path');

    // Set initial state (invisible)
    if (paths) {
        gsap.set(paths, { opacity: 0 });
    }

    // Animate each path to appear one by one
    paths?.forEach((path, index) => {
        tl.to(path, { opacity: 1, duration: 0.5 }, `path${index}`);
    });
   
     // Fade out
    tl.to(logo, { opacity: 0, duration: 0.5 }, '-=0.8');

    return () => {
      tl.kill();
    };
  }, [setIsShow]);

  return (
    <div className={`fixed z-50 h-screen w-screen bg-midnight ${isHidden && 'hidden'}`}>
      <div className="w-full h-full flex items-center place-content-center">
        <svg
          ref={logoRef}
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          width="500"
          height="500"
        >
          <path
            d="M0 0 C1.134375 0.020625 2.26875 0.04125 3.4375 0.0625 C7.26488508 8.18148271 10.26280474 16.5730311 13.29345703 25.01245117 C14.1946399 27.51986578 15.1028505 30.02465914 16.01171875 32.52929688 C16.58635547 34.12224512 17.16058912 35.71533883 17.734375 37.30859375 C18.00618591 38.05749374 18.27799683 38.80639374 18.55804443 39.57798767 C20.4375 44.83242113 20.4375 44.83242113 20.4375 47.0625 C18.1275 47.0625 15.8175 47.0625 13.4375 47.0625 C12.1175 44.0925 10.7975 41.1225 9.4375 38.0625 C3.1675 38.0625 -3.1025 38.0625 -9.5625 38.0625 C-10.8825 41.0325 -12.2025 44.0025 -13.5625 47.0625 C-15.8725 47.0625 -18.1825 47.0625 -20.5625 47.0625 C-19.79527885 42.02407117 -17.97250995 37.39989963 -16.21875 32.640625 C-15.72501892 31.28973785 -15.72501892 31.28973785 -15.22131348 29.91156006 C-14.52707718 28.01477354 -13.83103392 26.11864753 -13.13330078 24.22314453 C-12.06183373 21.31068894 -10.99731469 18.39576116 -9.93359375 15.48046875 C-9.25822371 13.63787006 -8.58245634 11.79541694 -7.90625 9.953125 C-7.58644165 9.07714661 -7.2666333 8.20116821 -6.93713379 7.29864502 C-6.64012573 6.49400818 -6.34311768 5.68937134 -6.03710938 4.86035156 C-5.7758728 4.1492926 -5.51463623 3.43823364 -5.2454834 2.70562744 C-3.95945826 -0.3883031 -3.72125074 0.0652851 0 0 Z M-0.5625 10.0625 C-2.8725 16.6625 -5.1825 23.2625 -7.5625 30.0625 C-2.66181037 31.69606321 2.29488476 31.11779694 7.4375 31.0625 C5.1275 24.1325 2.8175 17.2025 0.4375 10.0625 C0.1075 10.0625 -0.2225 10.0625 -0.5625 10.0625 Z "
            fill="#55DABA"
            transform="translate(212.5625,225.9375)"
          />
          <path
            d="M0 0 C2.21428453 2.4275584 3.2115435 4.30948143 3.56640625 7.57421875 C3.46328125 8.27546875 3.36015625 8.97671875 3.25390625 9.69921875 C0.94390625 9.69921875 -1.36609375 9.69921875 -3.74609375 9.69921875 C-4.07609375 8.04921875 -4.40609375 6.39921875 -4.74609375 4.69921875 C-9.46209193 3.77451322 -12.41874984 3.46998098 -16.74609375 5.69921875 C-16.86935297 8.12212325 -16.86935297 8.12212325 -15.74609375 10.69921875 C-13.06265864 12.00191544 -10.68925383 12.94691326 -7.87109375 13.82421875 C-6.41285478 14.29833863 -4.95700122 14.77987265 -3.50390625 15.26953125 C-2.85566895 15.47336426 -2.20743164 15.67719727 -1.53955078 15.88720703 C0.58639249 16.84975635 1.76968051 17.905481 3.25390625 19.69921875 C4.16380027 22.91884374 4.4056799 25.06176941 3.62890625 28.32421875 C1.3586973 32.24548875 -1.48652613 34.27936288 -5.74609375 35.69921875 C-12.75676722 36.39360927 -17.48115082 35.34646977 -23.05859375 30.82421875 C-24.96879703 28.41877758 -25.41024507 26.72185685 -25.74609375 23.69921875 C-23.10609375 23.69921875 -20.46609375 23.69921875 -17.74609375 23.69921875 C-17.41609375 25.01921875 -17.08609375 26.33921875 -16.74609375 27.69921875 C-15.14493799 27.94855445 -13.53989216 28.17300523 -11.93359375 28.38671875 C-10.59361328 28.57814453 -10.59361328 28.57814453 -9.2265625 28.7734375 C-6.72240741 28.91953296 -6.72240741 28.91953296 -4.921875 27.46875 C-3.37714265 25.49804473 -3.37714265 25.49804473 -3.74609375 21.69921875 C-4.53113281 21.5290625 -5.31617188 21.35890625 -6.125 21.18359375 C-20.27764498 17.91893454 -20.27764498 17.91893454 -24.18359375 12.82421875 C-24.97124538 9.84864593 -25.17683522 7.77594353 -24.74609375 4.69921875 C-22.12064443 0.43286361 -20.72414789 -0.90292872 -16.05859375 -2.80078125 C-10.61374655 -3.79075347 -4.54597238 -3.38659687 0 0 Z "
            fill="#54D8B9"
            transform="translate(287.74609375,238.30078125)"
          />
          <path
            d="M0 0 C0 2.64 0 5.28 0 8 C-2.01822917 8.42317708 -4.03645833 8.84635417 -6.0546875 9.26953125 C-8.37046549 9.92308838 -8.37046549 9.92308838 -10 13 C-10.36798693 15.71075544 -10.36798693 15.71075544 -10.4140625 18.76171875 C-10.45273438 19.87998047 -10.49140625 20.99824219 -10.53125 22.15039062 C-10.5621875 23.31763672 -10.593125 24.48488281 -10.625 25.6875 C-10.66367188 26.86634766 -10.70234375 28.04519531 -10.7421875 29.25976562 C-10.83654391 32.17301977 -10.92213161 35.08626607 -11 38 C-13.31 38 -15.62 38 -18 38 C-18 25.79 -18 13.58 -18 1 C-15.69 1 -13.38 1 -11 1 C-10.67 1.99 -10.34 2.98 -10 4 C-9.13375 3.2884375 -9.13375 3.2884375 -8.25 2.5625 C-5.48023273 0.63905051 -3.34663231 0 0 0 Z "
            fill="#57DFBF"
            transform="translate(258,235)"
          />
          <path
            d="M0 0 C11.88 0 23.76 0 36 0 C36 2.31 36 4.62 36 7 C24.12 7 12.24 7 0 7 C0 4.69 0 2.38 0 0 Z "
            fill="#4FCBAD"
            transform="translate(301,275)"
          />
          <path d="" fill="#000000" transform="translate(0,0)" />
        </svg>
      </div>
    </div>
  );
};

export default IconAnimation;
